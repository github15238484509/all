<style>
    .layui-table-cell {
        display: block;
        height: auto !important;
        line-height: 20px !important;
    }
</style>
<script type="text/html" template lay-done="layui.data.sendParams(d.params)">
    <div class="layui-tab layui-tab-brief" lay-filter="docDemoTabBrief">
        <ul class="layui-tab-title">
            <li class="layui-this">基本信息</li>
            <li>图文详情</li>
            <li>参数设置</li>
            <li>规格参数</li>
        </ul>
        <div class="layui-tab-content">
            <div class="layui-tab-item layui-show">
                <form class="layui-form" action="" lay-filter="formTest">
                    <div style="border-bottom: 1px solid #ccc;">
                        <div class="layui-row">
                            <div class="layui-form-item">
                                <label class="layui-form-label">商品名称：</label>
                                <div class="layui-input-block goods_name" style="line-height: 38px;">

                                </div>
                            </div>
                        </div>
                        <div class="layui-row">
                            <div class="layui-form-item">
                                <label class="layui-form-label">商品描述：</label>
                                <div class="layui-input-block goods_intro" style="line-height: 38px;">
                                </div>
                            </div>
                        </div>
                        <!-- <div class="layui-row">
                            <div class="layui-form-item">
                                <label class="layui-form-label">复制文案：</label>
                                <div class="layui-input-block goods_copy_writer" style="line-height: 38px;">
                                </div>
                            </div>
                        </div> -->
                        <div class="layui-row">
                            <div class="layui-form-item">
                                <div class="layui-row">
                                    <div class="layui-col-xs4">
                                        <label class="layui-form-label">商品分类：</label>
                                        <div class="layui-input-block goods_sort" style="line-height: 38px;">

                                        </div>
                                    </div>
                                    <div class="layui-col-xs4">
                                        <label class="layui-form-label">关键词：</label>
                                        <div class="layui-input-block keywords" style="line-height: 38px;">
                                        </div>
                                    </div>
                                    <div class="layui-col-xs4" style="display: none;">
                                        <label class="layui-form-label">品牌：</label>
                                        <div class="layui-input-block goods_brand" style="line-height: 38px;">

                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="layui-row">
                            <div class="layui-form-item">
                                <div class="layui-row">
                                    <div class="layui-col-xs4">
                                        <label class="layui-form-label">在售价：</label>
                                        <div class="layui-input-block goods_cost" style="line-height: 38px;">
                                        </div>
                                    </div>
                                    <div class="layui-col-xs4">
                                        <label class="layui-form-label">市场价：</label>
                                        <div class="layui-input-block goods_price" style="line-height: 38px;">
                                        </div>
                                    </div>
                                    <div class="layui-col-xs4">
                                        <label class="layui-form-label">供货价：</label>
                                        <div class="layui-input-block retail_price" style="line-height: 38px;">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="layui-row">
                            <div class="layui-form-item">
                                <div class="layui-row">
                                    <div class="layui-col-xs4">
                                        <label class="layui-form-label">计数单位：</label>
                                        <div class="layui-input-block goods_unit" style="line-height: 38px;">
                                        </div>
                                    </div>
                                    <div class="layui-col-xs8">
                                        <label class="layui-form-label">包装清单：</label>
                                        <div class="layui-input-block goods_pack" style="line-height: 38px;">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div>
                        <div class="layui-row">
                            <div class="layui-form-item">
                                <label class="layui-form-label">商品图片：</label>
                                <div class="layui-input-block goods_icon" style="line-height: 38px;display:flex;">

                                </div>
                            </div>
                        </div>
                        <div class="layui-row">
                            <div class="layui-form-item">
                                <label class="layui-form-label">视频封面：</label>
                                <div class="layui-input-block goods_video_cover" style="line-height: 38px;">

                                </div>
                            </div>
                        </div>
                        <div class="layui-row">
                            <div class="layui-form-item">
                                <label class="layui-form-label">商品视频：</label>
                                <div class="layui-input-block goods_video" style="line-height: 38px;">

                                </div>
                            </div>
                        </div>
                    </div>

                </form>

            </div>
            <div class="layui-tab-item ">
                <form class="layui-form" action="" lay-filter="formTest1">
                    <div class="layui-row">
                        <div class="layui-form-item">
                            <div class="goods_details">

                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="layui-tab-item">
                <div class="layui-row">
                    <div class="layui-form-item">
                        <div class="layui-row goods_params">

                        </div>
                    </div>
                </div>
            </div>
            <div class="layui-tab-item">
                <table class="layui-hide" id="goodsSku" lay-filter="goodsSku"></table>
            </div>
        </div>
        <form class="layui-form" action="" id="formId">
            <div style="display:none" id="display">
                <div class="layui-form-item">
                    <label class="layui-form-label">审核状态：</label>
                    <div class="layui-input-block">
                        <input type="radio" name="type" value="1" title="通过" checked lay-filter="radio">
                        <input type="radio" name="type" value="2" title="拒绝" lay-filter="radio">
                    </div>
                </div>
                <div class="layui-form-item zone" style="display:none">
                    <label class="layui-form-label">选择分区：</label>
                    <div class="layui-input-inline">
                        <select name="goods_zone" class="goods_zone" lay-filter="select1">
                            <option value="">请选择</option>
                        </select>
                    </div>
                </div>
                <div class="layui-form-item tag" style="display:none">
                    <label class="layui-form-label">选择标签：</label>
                    <div class="layui-input-inline">
                        <select name="goods_tag" class="goods_tag" lay-filter="select1">
                            <option value="">请选择</option>
                        </select>
                    </div>
                </div>
                <div class="layui-form-item reason" style="display:none">
                    <label class="layui-form-label">拒绝原因：</label>
                    <div class="layui-input-block">
                        <textarea name="refuse_reason" id="" cols="30" rows="10" placeholder="输入拒绝原因" style="padding:10px"></textarea>
                    </div>
                </div>
                <div class="layui-form-item">
                    <div class="layui-input-block" style="width:200px;">
                        <button type="submit" class="layui-btn" style="width:100%;" lay-submit="" lay-filter="submit">确定</button>
                    </div>
                </div>
            </div>
        </form>
    </div>
</script>


<script>
    layui.data.sendParams = function(params) {
        layui.use(['admin', 'element', 'form', 'public', 'table'], function() {
            var admin = layui.admin;
            var form = layui.form;
            var $ = layui.jquery,
                element = layui.element;
            var table = layui.table;
            var base = new layui.public.Base64();
            if (params.data.type == 1) {
                $('#display').css('display', 'block')
                $('.zone').css('display', 'block')
                $('.tag').css('display', 'block')
            }
            //判断是否显示分区
            admin.req({
                    url: layui.setter.requestUrl + 'api.php?c=goods_zone/getGoodsZone',
                    success: function(res) {
                        console.log(res)
                        if (res.code == 0) {
                            if (res.data.length != 0) {
                                $('.zone').css('display', 'block')
                                res.data.forEach(item => {
                                    $('.goods_zone').append(
                                        `<option value="${item.zone_index}">${item.zone_name}</option>`
                                    )
                                });
                                form.render()
                            }
                        }
                    }
                })
                //判断是否显示标签
            admin.req({
                    url: layui.setter.requestUrl + 'api.php?c=goods_tag/getGoodsTag',
                    success: function(res) {
                        if (res.code == 0) {
                            if (res.data.length != 0) {
                                $('.tag').css('display', 'block')
                                res.data.forEach(item => {
                                    $('.goods_tag').append(
                                        `<option value="${item.tag_index}">${item.tag_name}</option>`
                                    )
                                });
                                form.render()
                            }
                        }
                    }
                })
                //切换单选按钮
            form.on('radio(radio)', function(data) {
                if (data.value == 2) {
                    $('.reason').css('display', 'block')
                    $('.zone').css('display', 'none')
                    $('.tag').css('display', 'none')
                } else {
                    $('.reason').css('display', 'none')
                    $('.zone').css('display', 'block')
                    $('.tag').css('display', 'block')
                }
            });
            admin.req({
                url: layui.setter.requestUrl + 'api.php?c=supplier_goods/getGoodsDetails',
                data: {
                    goods_index: params.data.goods_index
                },
                success: function(res) {
                    // console.log(res)
                    $('.goods_name').html(res.data.goods_name);
                    $('.goods_intro').html(base.decode(res.data.goods_intro));
                    $('.goods_copy_writer').html(res.data.goods_copy_writer);
                    $('.keywords').html(res.data.keywords);
                    $('.goods_cost').html(res.data.goods_cost / 100);
                    $('.goods_price').html(res.data.goods_price / 100);
                    $('.retail_price').html(res.data.retail_price / 100);
                    $('.goods_unit').html(res.data.goods_unit);
                    $('.goods_pack').html(res.data.goods_pack);
                    $('.goods_brand').html(res.data.goods_brand);
                    $('.goods_sort').html(res.data.goods_sort + ',' + res.data.goods_sort2);
                    let goodsImg = res.data.goods_icon.split(',')
                    if (goodsImg.length > 1) {
                        goodsImg.forEach(item => {
                            $('.goods_icon').append(
                                `<div style="width:100px;height:100px;margin-right:10px;margin-top:10px;"><img style="width:100%;height:100%;" src="${layui.setter.CDN+item}" alt=""></div>`
                            );
                        });
                    } else {
                        if (goodsImg.length == 1) {
                            $('.goods_icon').html(
                                `<div style="width:100px;height:100px;margin-right:10px;margin-top:10px;"><img style="width:100%;height:100%;" src="${layui.setter.CDN+res.data.goods_icon}" alt=""></div>`
                            );
                        } else {
                            $('.goods_icon').html('暂无')
                        }

                    }
                    if (res.data.goods_video_cover) {
                        $('.goods_video_cover').html(
                            `<div style="width:100px;height:100px;margin-right:10px;margin-top:10px;"><img style="width:100%;height:100%;" src="${layui.setter.CDN+res.data.goods_video_cover}" alt=""></div>`
                        );
                    } else {
                        $('.goods_video_cover').html('暂无')
                    }
                    if (res.data.goods_video) {
                        $('.goods_video').html(
                            `<div style="width:100px;height:100px;margin-right:10px;margin-top:10px;">
                            <video style="width:100%;height:100%;"" src="${layui.setter.CDN+res.data.goods_video}" controls></video></div>`
                        );
                    } else {
                        $('.goods_video').html('暂无')
                    }
                    // //主图
                    // $('.goods_video').html(
                    //     `<div style="width:100px;height:100px;margin-right:10px;margin-top:10px;"><img style="width:100%;height:100%;" src="${layui.setter.CDN+res.data.goods_video}" alt=""></div>`
                    // );

                    //图文详情
                    $('.goods_details').html(base.decode(res.data.goods_details));
                    //参数设置
                    if (res.data.goods_params.length > 0) {
                        res.data.goods_params.forEach(item => {
                            $('.goods_params').append(`
                                <div class="layui-col-xs6" style="display:${item.name=='品牌'?'none':''}">
                                    <label class="layui-form-label">${item.name}：</label>
                                    <div class="layui-input-block" style="line-height: 38px;">
                                        ${item.value}
                                    </div>
                                </div>
                            `)
                        });
                    }

                }
            })


            //渲染表格数据
            var render_table4 = function(data) {
                table.render({
                    elem: '#goodsSku',
                    url: layui.setter.requestUrl + 'api.php?c=supplier_goods/getGoodsDetails',
                    where: {
                        goods_index: params.data.goods_index
                    },
                    cols: cols = [
                        [{
                            width: 220,
                            field: 'sku_name',
                            title: '参数',
                            align: 'center',

                        }, {
                            width: 120,
                            field: 'sku_pic',
                            title: '图片',
                            align: 'center',
                            templet: function(d) {
                                return `<div style="width:50px;height:50px;"><img style="width:100%;" src="${layui.setter.CDN+d.sku_pic}" alt=""></div>`
                            }
                        }, {
                            width: 100,
                            field: 'sku_cost_price',
                            title: '售价',
                            align: 'center',
                            templet: function(d) {
                                var str = d.sku_cost_price / 100
                                return str
                            }
                        }, {
                            width: 100,
                            field: 'sku_retail_price',
                            title: '供货价',
                            align: 'center',
                            templet: function(d) {
                                var str = d.sku_retail_price / 100
                                return str
                            }
                        }, {
                            width: 100,
                            field: 'sku_market_price',
                            title: '市场价',
                            align: 'center',
                            templet: function(d) {
                                var str = d.sku_market_price / 100
                                return str
                            }
                        }, {
                            width: 100,
                            field: 'sku_inventory',
                            title: '库存',
                            align: 'center',

                        }, {
                            width: 100,
                            field: 'sku_code',
                            title: '商品编号',
                            align: 'center',
                        }, {
                            width: 123,
                            field: 'weight',
                            title: '重量（kg）',
                            align: 'center',
                        }, {
                            width: 123,
                            field: 'volume',
                            title: '体积（m³）',
                            align: 'center',
                        }]
                    ],
                    page: true,
                    parseData: function(res) {
                        console.log(res)
                        return {
                            "count": res.count, //解析接口状态
                            "code": res.code, //解析接口状态
                            "data": res.data.goods_sku_list //解析数据列表
                        };
                    }, // 解决高度自适应固定的列高度不一致
                });
            }
            render_table4();
            //提交
            form.on('submit(submit)', function(data) {
                data.field.goods_index = params.data.goods_index
                if (data.field.type == 1) {
                    if (data.field.goods_zone == '') {
                        layer.msg('请选择分区');
                        return false;
                    } else {
                        data.field.refuse_reason = ''
                        admin.req({
                            url: layui.setter.requestUrl +
                                'api.php?c=supplier_goods/changeGoods',
                            data: data.field,
                            success: function(res) {
                                if (res.code == 0) {
                                    layer.msg(res.msg);
                                    layer.closeAll();
                                    parent.layui.table.reload("goodsTable1");
                                } else {
                                    layer.msg(res.msg);
                                }
                            }
                        })
                    }
                } else {
                    if (data.field.refuse_reason == '') {
                        layer.msg('请输入拒绝原因');
                        return false;
                    } else {
                        data.field.goods_zone = ''
                        data.field.goods_tag = ''
                        admin.req({
                            url: layui.setter.requestUrl +
                                'api.php?c=supplier_goods/changeGoods',
                            data: data.field,
                            success: function(res) {
                                if (res.code == 0) {
                                    layer.msg(res.msg);
                                    layer.closeAll();
                                    parent.layui.table.reload("goodsTable1");
                                } else {
                                    layer.msg(res.msg);
                                }
                            }
                        })
                    }
                }

                return false;
            });
            form.render()

        })
    }
</script>