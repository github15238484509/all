<script type="text/html" template>
    <link rel="stylesheet" href="{{ layui.setter.base }}style/login.css?v={{ layui.admin.v }}-1" media="all">
</script>
<style>
    body {
        background: #fff;
    }
    
    .herder {
        height: 86.4px;
    }
    
    .herder_bg {
        width: 80%;
        height: 100%;
        float: right;
    }
    
    .herder_bg img {
        width: 80px;
        height: 80px;
    }
    
    .herder_bg span {
        display: inline-block;
        vertical-align: bottom;
        font-size: 22px;
        color: rgb(0, 0, 0);
        font-weight: 600;
        font-family: KaiTi;
    }
    
    .center {
        height: 530px;
        display: flex;
        align-items: center;
        position: relative;
    }
    
    .center_logo {
        width: 100%;
        height: 465px;
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
    }
    
    .logo_box {
        position: relative;
        width: 400px;
        height: 450px;
        background: #fff;
        border-radius: 8px;
        float: right;
        margin-right: 10%;
    }
    
    .logo_box>.mask_box {
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        font-weight: 400;
        z-index: 9999;
        display: flex;
        align-items: center;
        flex-wrap: wrap;
        justify-content: center;
        color: #ffffff;
    }
    
    .logo_box>.mask_box>.mask_box_inner {
        display: flex;
        justify-content: center;
        flex-wrap: wrap;
        height: 200px;
        text-align: left;
    }
    
    .logo_box>.mask_box>.mask_box_inner>image {
        width: 80px;
        height: 80px;
    }
    
    .footer p {
        margin: 10px 0;
        font-family: "Hiragino Sans GB";
        font-size: 12px;
        color: rgb(158, 167, 180);
        text-align: center;
    }
    
    a {
        color: rgb(158, 167, 180);
    }
    
    a:hover {
        color: #f90;
    }
</style>
<!-- 盒子 -->
<div class="box">
    <!--头部  -->
    <div class="herder">
        <div class="herder_bg">
            <img src="/marketadmin/src/images/jianyunlogo00.png" alt="">
            <span>简云科技，助你简便进入云时代</span>
        </div>
    </div>
    <!-- 中间 -->
    <div class="center">
        <div class="layui-carousel" id="test1">
            <div carousel-item>
                <div><img style="width: 100%;height:100%;" src="/marketadmin/src/images/login-bgs1.png" alt=""></div>
                <div><img style="width: 100%;height:100%;" src="/marketadmin/src/images/login-bgs2.png" alt=""></div>
                <div><img style="width: 100%;height:100%;" src="/marketadmin/src/images/login-bgs3.png" alt=""></div>
                <div><img style="width: 100%;height:100%;" src="/marketadmin/src/images/login-bgs4.png" alt=""></div>
            </div>
        </div>
        <div class="center_logo">
            <div class="logo_box">
                <!-- <div class="mask_box" style="display: none;">

          <div class="mask_box_inner">

            <div >
              <img src="shibai.png" alt="">
            </div>
            <div style="margin-left: 6px;">  您的系统服务已到期，请2021年6月15日前联系我们续费服务，逾期将自动释放系统及相关数据。</div>
            <div style="margin-top: 3px;">联系电话：400-8086-828</div>
          </div>


        </div> -->
                <div style="display: flex;justify-content: space-between;">
                    <!-- <div style="font-family:Hiragino Sans GB;font-size: 18px;color: rgb(255, 122, 34);padding: 10px 20px;cursor: pointer;" class="login">扫码登录</div> -->
                    <div style="font-family:Hiragino Sans GB;font-size: 18px;padding: 10px 20px;cursor: pointer;" class="login">
                        密码登录</div>
                </div>
                <div id="wxLogin">
                    <iframe src="" frameborder="0" scrolling="no" width="100%" height="400px" id='iframe'></iframe>
                </div>
                <div class="layadmin-user-login-box layadmin-user-login-body layui-form passwordLogin" style="display: none;">
                    <div class="layui-form-item">
                        <label class="layadmin-user-login-icon layui-icon layui-icon-username" for="LAY-user-login-username"></label>
                        <input type="text" name="username" id="LAY-user-login-username" lay-verify="required" placeholder="用户名" class="layui-input">
                    </div>
                    <div class="layui-form-item">
                        <label class="layadmin-user-login-icon layui-icon layui-icon-password" for="LAY-user-login-password"></label>
                        <input type="password" name="password" id="LAY-user-login-password" lay-verify="required" placeholder="密码" class="layui-input">
                    </div>
                    <div class="layui-form-item">
                        <div class="layui-row">
                            <div class="layui-col-xs7">
                                <label class="layadmin-user-login-icon layui-icon layui-icon-vercode" for="LAY-user-login-vercode"></label>
                                <input type="text" name="vercode" id="LAY-user-login-vercode" lay-verify="required" placeholder="图形验证码" class="layui-input">
                            </div>
                            <div class="layui-col-xs5">
                                <div style="margin-left: 10px;">
                                    <img src="" class="layadmin-user-login-codeimg img" id="LAY-user-get-vercode">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="layui-form-item" style="margin-bottom: 20px;">
                        <input type="checkbox" name="remember" lay-skin="primary" title="使我保持登录状态">
                    </div>
                    <div class="layui-form-item" style="text-align: center;">
                        <button class="layui-btn layui-btn-fluid" lay-submit lay-filter="LAY-user-login-submit" style="width:250px;height:45px;border-radius:25px;color: #fff;background-color: #f90;border-color: #f90;margin-top: 30px;">登
              入</button>
                    </div>
                    <!-- <div>
                        <div style="height: 60px; background-color: #f5f5f5;">
                            <div style="font-size:14px;"> <img style="width: 16px;height: 16px; margin-left: 3px;" src="shibai.png" alt="">系统服务即将于2021-04-15日0点到期，请及时联系我们~！</div>
                            <div>联系电话：400-8086-828</div>
                        </div>
                    </div> -->
                </div>
            </div>
        </div>
    </div>
    <!-- 底部 -->
    <div class="footer">
        <p><a href="http://www.jianyunkeji.cn/#/about" target="_blank">关于我们</a> | <a href="http://www.jianyunkeji.cn/#/lianxi" target="_blank">联系我们</a> | <a href="http://www.jianyunkeji.cn/#/jiaru" target="_blank">加入我们</a> | <a href="http://www.jianyunkeji.cn/#/Companyprofile"
                target="_blank">公司简介</a> | <a href="http://www.jianyunkeji.cn/#/wangzhan" target="_blank">网站建设</a> | <a href="http://www.jianyunkeji.cn/#/apps" target="_blank">APP开发</a> | <a href="http://www.jianyunkeji.cn/#/weixin" target="_blank">微信小程序</a></p>
        <p>Copyright © 2018-2019 河南简云网络科技有限公司 版权所有 | <a href="http://www.beian.miit.gov.cn/" target="_blank">技术支持：简云科技-助你简便进入云时代 | 豫ICP备18014626号</a></p>
    </div>
</div>
<script>
    layui.use(['admin', 'form', 'user', 'carousel', 'md5'], function() {
        var $ = layui.$,
            _$ = layui.jquery,
            setter = layui.setter,
            admin = layui.admin,
            form = layui.form,
            router = layui.router(),
            search = router.search;
        form.render();
        var carousel = layui.carousel;
        //建造实例
        carousel.render({
            elem: '#test1',
            width: '100%',
            height: '100%' //设置容器宽度
                ,
            arrow: 'none',
            interval: '3000',
            indicator: 'none'
                // ,anim: 'fade' //切换动画方式
        });

        //先隐藏遮罩层

        var timestamp = Date.parse(new Date()) / 1000;
        console.log(timestamp)
            //如果当前时间戳 大于4月15日 则显示

        if (timestamp > 1618479030) {
            $('.mask_box').show()
        }




        $('#iframe').attr('src',
                `https://open.weixin.qq.com/connect/qrconnect?appid=wxebd55806698d5ede&redirect_uri=${layui.setter.requestUrl}/admin/src/views/user/weChetLogin.html&response_type=code&scope=snsapi_login&state=3d6be0a4035d839573b04816624a415e#wechat_redirect`
            )
            //获取验证码  切换验证码在controller下的user.js
        $('.img').attr('src', layui.setter.requestUrl + '/ImageCode.php?width=120&height=38&count=4')
            //提交
        form.on('submit(LAY-user-login-submit)', function(obj) {
            obj.field.password = layui.md5(obj.field.password); //使用md5()方法对密码加密
            //判断是否记住密码  1是记住 0是不记
            if (obj.field.remember && obj.field.remember == 'on') {
                obj.field.remember = '1'
            } else {
                obj.field.remember = '0'
            }
            //请求登入接口
            $.ajax({
                url: layui.setter.requestUrl + '/api.php?c=login/doLogin', //实际使用请改成服务端真实接口
                type: 'get',
                data: {
                    account: obj.field.username,
                    md5Pwd: obj.field.password,
                    remember: obj.field.remember,
                    verification: obj.field.vercode
                },
                success: function(res) {
                    if (res.msg == '登陆成功~！') {
                        //请求成功后，写入 access_token
                        layui.data(setter.tableName, {
                            key: setter.request.tokenName,
                            value: res.data.access_token
                        });
                        layui.data(setter.tableName, {
                            key: 'employee_id',
                            value: res.data.employee_id
                        });
                        layui.data(setter.tableName, {
                            key: 'employee_name',
                            value: res.data.employee_name
                        });
                        //登入成功的提示与跳转
                        layer.msg('登入成功', {
                            offset: '15px',
                            icon: 1,
                            time: 1000
                        }, function() {
                            location.hash = res.data.home_page_url ? '/' + res.data.home_page_url : '/';
                        });
                    } else {
                        layer.msg(res.msg, {
                            offset: '15px',
                            icon: 2,
                            time: 1000
                        })
                    }
                }
            })
        });
        $('#wxLogin').hide();
        $('.passwordLogin').show();
        // $('.login').on('click',function(){
        //   $(this).css('color','rgb(255, 122, 34)').siblings().css('color','#333');
        //       if($(this).index()==0){
        //         $('#wxLogin').show(200);
        //         $('.passwordLogin').hide();
        //       }else{
        //         $('.passwordLogin').show(200);
        //         $('#wxLogin').hide();
        //       }
        // })
    });
</script>